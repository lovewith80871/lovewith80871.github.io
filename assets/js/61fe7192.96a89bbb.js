"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[9410],{3905:(t,e,n)=>{n.d(e,{Zo:()=>i,kt:()=>d});var a=n(7294);function r(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function u(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,a)}return n}function o(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?u(Object(n),!0).forEach((function(e){r(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function s(t,e){if(null==t)return{};var n,a,r=function(t,e){if(null==t)return{};var n,a,r={},u=Object.keys(t);for(a=0;a<u.length;a++)n=u[a],e.indexOf(n)>=0||(r[n]=t[n]);return r}(t,e);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(t);for(a=0;a<u.length;a++)n=u[a],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(r[n]=t[n])}return r}var l=a.createContext({}),c=function(t){var e=a.useContext(l),n=e;return t&&(n="function"==typeof t?t(e):o(o({},e),t)),n},i=function(t){var e=c(t.components);return a.createElement(l.Provider,{value:e},t.children)},m={inlineCode:"code",wrapper:function(t){var e=t.children;return a.createElement(a.Fragment,{},e)}},p=a.forwardRef((function(t,e){var n=t.components,r=t.mdxType,u=t.originalType,l=t.parentName,i=s(t,["components","mdxType","originalType","parentName"]),p=c(n),d=r,k=p["".concat(l,".").concat(d)]||p[d]||m[d]||u;return n?a.createElement(k,o(o({ref:e},i),{},{components:n})):a.createElement(k,o({ref:e},i))}));function d(t,e){var n=arguments,r=e&&e.mdxType;if("string"==typeof t||r){var u=n.length,o=new Array(u);o[0]=p;var s={};for(var l in e)hasOwnProperty.call(e,l)&&(s[l]=e[l]);s.originalType=t,s.mdxType="string"==typeof t?t:r,o[1]=s;for(var c=2;c<u;c++)o[c]=n[c];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}p.displayName="MDXCreateElement"},8168:(t,e,n)=>{n.r(e),n.d(e,{assets:()=>l,contentTitle:()=>o,default:()=>m,frontMatter:()=>u,metadata:()=>s,toc:()=>c});var a=n(7462),r=(n(7294),n(3905));const u={slug:"/useState_anylisis"},o="useState \u5206\u6790",s={unversionedId:"react/02useState_diy",id:"react/02useState_diy",title:"useState \u5206\u6790",description:"\u5148\u9644\u4e0a github \u9023\u7d50",source:"@site/docs/react/02useState_diy.md",sourceDirName:"react",slug:"/useState_anylisis",permalink:"/docs/useState_anylisis",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/react/02useState_diy.md",tags:[],version:"current",frontMatter:{slug:"/useState_anylisis"},sidebar:"tutorialSidebar",previous:{title:"useState \u4ecb\u7d39",permalink:"/docs/useState_intro"},next:{title:"Mocks Server \u4ecb\u7d39",permalink:"/docs/mockServer_intro"}},l={},c=[{value:"\u5927\u7db1",id:"\u5927\u7db1",level:2},{value:"\u5148\u5f9e\u7b2c 1, 2 \u9ede\u4f86\u5b8c\u6210\u4e00\u958b\u59cb\u7684 useState \u67b6\u69cb\u3002",id:"\u5148\u5f9e\u7b2c-1-2-\u9ede\u4f86\u5b8c\u6210\u4e00\u958b\u59cb\u7684-usestate-\u67b6\u69cb",level:2},{value:"Initial state \u662f\u9700\u8981\u88ab\u8a18\u61b6\u4e14\u4e0d\u80fd\u88ab\u91cd\u65b0\u5b9a\u7fa9\u7684\u3002",id:"initial-state-\u662f\u9700\u8981\u88ab\u8a18\u61b6\u4e14\u4e0d\u80fd\u88ab\u91cd\u65b0\u5b9a\u7fa9\u7684",level:2},{value:"\u8981\u80fd\u9023\u7e8c\u5b9a\u7fa9\u7684 useState",id:"\u8981\u80fd\u9023\u7e8c\u5b9a\u7fa9\u7684-usestate",level:2},{value:"\u5be6\u73fe setCount(count + 1) and setCount((count) =&gt; count + 1) \u7684\u4e0d\u540c",id:"\u5be6\u73fe-setcountcount--1-and-setcountcount--count--1-\u7684\u4e0d\u540c",level:2},{value:"\u5be6\u73fe Lazy initial state",id:"\u5be6\u73fe-lazy-initial-state",level:2}],i={toc:c};function m(t){let{components:e,...n}=t;return(0,r.kt)("wrapper",(0,a.Z)({},i,n,{components:e,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"usestate-\u5206\u6790"},"useState \u5206\u6790"),(0,r.kt)("p",null,"\u5148\u9644\u4e0a ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/lovewith80871/customizeUseState"},"github \u9023\u7d50")),(0,r.kt)("p",null,"\u5206\u6790 useState \u529f\u80fd\uff0c\u4e26\u4e14\u5617\u8a66\u81ea\u5df1\u5beb\u4e00\u500b useState\u3002",(0,r.kt)("br",null),"\n\u4e00\u958b\u59cb\u6211\u5011\u9700\u8981\u91d0\u6e05\u9019\u500b useState \u9700\u8981\u6709\u4ec0\u9ebc\u9700\u6c42\u6216\u7279\u6027\u3002\u4ee5\u4e0b\u662f\u6211\u81ea\u5df1\u5217\u51fa\u9700\u8981\u9054\u6210\u7684\u9805\u76ee\u3002"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"\u662f\u4e00\u500b function\uff0c\u9700\u5e36\u5165\u4e00\u500b\u53c3\u6578\uff0c\u7136\u5f8c\u56de\u50b3\u4e00\u500b array \u5305\u542b ","[state, function]","\u3002"),(0,r.kt)("li",{parentName:"ol"},"\u4f7f\u7528 return \u7684 function \u7684\u6642\u5019\uff0c\u9700\u8981 re-render \u9801\u9762\u3002"),(0,r.kt)("li",{parentName:"ol"},"Initial state \u662f\u9700\u8981\u88ab\u8a18\u61b6\u4e14\u4e0d\u80fd\u88ab\u91cd\u65b0\u5b9a\u7fa9\u7684\u3002"),(0,r.kt)("li",{parentName:"ol"},"\u8981\u80fd\u9023\u7e8c\u5b9a\u7fa9\u7684 useState\u3002"),(0,r.kt)("li",{parentName:"ol"},"\u9700\u8981\u6ce8\u610f\u7684\u4e8b\u9805 ",(0,r.kt)("br",null),"\n(5.1) setCount(count + 1) and setCount((count) => count + 1) \u7684\u4e0d\u540c\uff1f",(0,r.kt)("br",null),"\n(5.2) Lazy initial state")),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"\u5927\u7db1"},"\u5927\u7db1"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u5148\u5f9e\u7b2c 1, 2 \u9ede\u4f86\u5b8c\u6210\u4e00\u958b\u59cb\u7684 useState \u67b6\u69cb"),(0,r.kt)("li",{parentName:"ul"},"Initial state \u662f\u9700\u8981\u88ab\u8a18\u61b6\u4e14\u4e0d\u80fd\u88ab\u91cd\u65b0\u5b9a\u7fa9\u7684"),(0,r.kt)("li",{parentName:"ul"},"\u8981\u80fd\u9023\u7e8c\u5b9a\u7fa9\u7684 useState"),(0,r.kt)("li",{parentName:"ul"},"\u5be6\u73fe setCount(count + 1) and setCount((count) => count + 1) \u7684\u4e0d\u540c"),(0,r.kt)("li",{parentName:"ul"},"\u5be6\u73fe Lazy initial state")),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"\u5148\u5f9e\u7b2c-1-2-\u9ede\u4f86\u5b8c\u6210\u4e00\u958b\u59cb\u7684-usestate-\u67b6\u69cb"},"\u5148\u5f9e\u7b2c 1, 2 \u9ede\u4f86\u5b8c\u6210\u4e00\u958b\u59cb\u7684 useState \u67b6\u69cb\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-jsx",metastring:"showLineNumbers",showLineNumbers:!0},"import React from 'react';\n// \u6211\u5011 import \u9019\u500bfunction \u4f86 rerender \u6211\u5011\u7684 component\nimport { render } from 'react-dom';\n\n// \u81ea\u5b9a\u7fa9 useState\nconst useState = (initialValue) => {\n  // \u5b9a\u7fa9 _state \u53bb\u63a5\u5f9e\u5916\u90e8\u50b3\u9032\u4f86\u7684 parameter (initialValue)\u3002\n  let _state = initialValue;\n\n  // \u5b9a\u7fa9 function\uff0c\u4e26\u900f\u904e function \u7684 parameter \u53bb\u4fee\u6539 _state\u3002\n  const callback = (newState) => {\n    _state = newState;\n\n    // function \u8981\u7d50\u675f\u6642\u91cd\u65b0 render \u756b\u9762\u3002\n    render(<SampleUseState />, document.getElementById('root'));\n  };\n\n  // \u56de\u50b3 [_state, callback function]\n  return [_state, callback];\n};\n\nconst SampleUseState = () => {\n  const [count, setCount] = useState(0);\n  const clickHandler = () => {\n    setCount(count + 1);\n  };\n  return (\n    <div>\n      <p>You clicked {count} times</p>\n      <button onClick={() => clickHandler()}>Click me</button>\n    </div>\n  );\n};\n\nexport default SampleUseState;\n")),(0,r.kt)("p",null,"\u5230\u9019\u88e1\u57fa\u672c\u4e0a\u6700\u539f\u59cb\u7684 useState \u67b6\u69cb\u5df2\u7d93\u5efa\u7f6e\u5b8c\u7562\uff0c\u4f46\u5be6\u969b\u4e0a\u62ff\u9019\u6bb5\u7a0b\u5f0f\u53bb\u4f7f\u7528\uff0c\u6703\u767c\u73fe\u300c \u8a92\uff5e\u5947\u602a\uff0c\u600e\u9ebc\u6309\u4e86 Click me\uff0c\u756b\u9762\u90fd\u6c92\u6709+1 \u5462 \u300d\u3002"),(0,r.kt)("p",null,"\u539f\u56e0\u662f\u7576\u6211\u7684 click \u89f8\u767c setCount \u7684\u6642\u5019\uff0c\u9019\u6642\u5019\u7684 ","_","state \u7684\u78ba\u6703\u8b8a\u6210 1\uff0c\u4f46\u6703\u89f8\u767c\u7b2c 15 \u884c\u7684 re-render\uff0c\u5c0e\u81f4 ","_","state \u6703\u91cd\u65b0\u88ab\u7b2c 23 \u884c\u7684 useState(0) \u8986\u84cb\u6389\uff0c\u9032\u800c\u9084\u662f\u51fa\u73fe 0 \u7684\u60c5\u6cc1\u3002\n\u6240\u4ee5\u518d\u4f86\u6211\u5011\u5c31\u5fc5\u9808\u4f86\u8a18\u61b6\u9019\u500b ","_","state\uff0c\u4e0d\u80fd\u8b93\u4ed6\u96a8\u96a8\u4fbf\u4fbf\u5c31\u88ab\u8986\u84cb\u6389\u3002"),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"initial-state-\u662f\u9700\u8981\u88ab\u8a18\u61b6\u4e14\u4e0d\u80fd\u88ab\u91cd\u65b0\u5b9a\u7fa9\u7684"},"Initial state \u662f\u9700\u8981\u88ab\u8a18\u61b6\u4e14\u4e0d\u80fd\u88ab\u91cd\u65b0\u5b9a\u7fa9\u7684\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-jsx",metastring:"showLineNumbers",showLineNumbers:!0},"let _state;\nconst useState = (initialValue) => {\n  _state = _state || initialValue;\n  const callback = (newState) => {\n    _state = newState;\n    render(<SampleUseState />, document.getElementById('root'));\n  };\n  return [_state, callback];\n};\n")),(0,r.kt)("p",null,"\u5148\u5c07\u539f\u672c\u5728 function \u5167\u7684 ","_","state \u62c9\u5230\u5916\u9762\u53bb\u5b9a\u7fa9\uff0c\u4e26\u5c07\u7b2c 3 \u884c\uff0c\u6539\u5beb\u6210\u5982\u4e0a\u8ff0\u7a0b\u5f0f\u78bc\u6240\u8996\u3002\u56e0\u70ba\u4e00\u958b\u59cb ","_","state \u6703\u662f undefined \u6240\u4ee5\u6703\u8b93 ","_","state \u7b49\u65bc initialValue\uff0c\u4e4b\u5f8c\u56e0\u70ba ","_","state \u6709\u503c\u4e86\uff0cinitialValue \u5c31\u4e0d\u6703\u518d\u8986\u5beb\u9032 ","_","state \u88e1\u3002\u9019\u6a23\u6211\u5011\u9ede\u9078 click \u5c31\u80fd\u4f7f count \u4e00\u76f4\u5f80\u4e0a+1 \u4e86\u3002"),(0,r.kt)("p",null,"\u4f46\u662f\u5230\u9019\u88e1\u9084\u6703\u6709\u500b\u554f\u984c\uff0c\u90a3\u5c31\u662f\u7576\u6211\u5011\u4f7f\u7528\u5230 ",(0,r.kt)("strong",{parentName:"p"},"\u8907\u6578")," \u7684 useState \u6642\uff08\u5982\u4e0b\uff09"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-jsx",metastring:"showLineNumbers",showLineNumbers:!0},"const SampleUseState = () => {\n  const [count, setCount] = useState(0);\n  const [count2, setCount2] = useState(0);\n  const clickHandler = () => {\n    setCount(count + 1); // \u4f7f count + 1\n    setCount2(count2 + 2); // \u4f7f count2 + 2\n  };\n  return (\n    <div>\n      <p>You clicked {count} times</p>\n      <p>You clicked {count2} times</p>\n      <button onClick={() => clickHandler()}>Click me</button>\n    </div>\n  );\n};\n")),(0,r.kt)("p",null,"\u6703\u767c\u73fe\uff0c\u6bcf\u7576\u6211\u5011\u89f8\u767c clickHandler \u6642 count \u6703\u548c count2 \u4e00\u6a23\uff0c\u4e00\u8d77\u88ab+2\uff0c\u4f46\u6211\u5011\u7684\u9810\u671f\u61c9\u8a72\u662f count \u53ea\u80fd\u88ab+1\uff0ccount2 \u624d\u662f+2\u3002\u90a3\u9019\u53c8\u662f\u600e\u6a23\uff1f"),(0,r.kt)("p",null,"\u5176\u5be6\u5c31\u662f count \u548c count2 \u5171\u7528\u4e86\u540c\u4e00\u500b ","_","state\uff0c\u4e26\u4e14 count2 \u6c61\u67d3\u5230\u4e86\u539f\u672c count \u7684 ","_","state\u3002"),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"\u8981\u80fd\u9023\u7e8c\u5b9a\u7fa9\u7684-usestate"},"\u8981\u80fd\u9023\u7e8c\u5b9a\u7fa9\u7684 useState"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-jsx",metastring:"showLineNumbers",showLineNumbers:!0},"// \u5c07\u539f\u672c\u7684 _state \u6539\u6210\u4e00\u500b\u9663\u5217\nlet memoizedState = [];\n\n// \u7576\u524d memoizedState index\u3002\nlet cursor = 0;\nconst useState = (initialValue) => {\n  memoizedState[cursor] = memoizedState[cursor] || initialValue;\n  const currentCursor = cursor;\n  const callback = (newState) => {\n    memoizedState[currentCursor] = newState;\n\n    // \u6e96\u5099\u91cd\u65b0 render \u756b\u9762\u524d\uff0c\u8981\u8a18\u5f97\u5c07 cursor \u521d\u59cb\u5316\u3002\n    cursor = 0;\n    render(<SampleUseState />, document.getElementById('root'));\n  };\n\n  // \u6bcf\u6b21 return \u5f8c\uff0c\u90fd\u6703\u5c07 cursor +1\n  return [memoizedState[cursor++], callback];\n};\n")),(0,r.kt)("p",null,"\u9019\u6a23\u5c31\u80fd\u5c07\u8907\u6578\u500b useState \u6240\u7522\u751f\u51fa\u7684 state\uff0c\u5206\u5225\u8a18\u5728\u9019\u500b\u9663\u5217\u88e1\u3002\u4e00\u958b\u59cb\uff0c\u6211\u5011\u5c07\u7b2c\u4e00\u500b state \u7684\u503c\u7d00\u9304\u5728 memoizedState","[0]","\uff0c\u7136\u5f8c\u5728 return \u6642\uff0c\u6211\u5011\u6703\u8b93 cursor+1\uff0c\u9019\u6a23\u4e0b\u4e00\u500b state \u5c31\u6703\u7d00\u9304\u5728 memoizedState","[1]"," \u7684\u4f4d\u7f6e\uff0c\u4ee5\u6b64\u985e\u63a8..."),(0,r.kt)("p",null,"\u9019\u6a23\u5beb\u5c31\u53ef\u4ee5\u5f88\u6f02\u4eae\u7684\u5c07 count \u9084\u6709 count2 \u5206\u958b\u4e86\uff01\uff01"),(0,r.kt)("p",null,"\u5230\u4e86\u9019\u88e1\uff0c\u6700\u57fa\u672c\u7684 useState \u5c31\u5b8c\u6210\u4e86\uff5e \u4e0d\u904e\u9084\u8a18\u5f97\u6211\u5011\u5728 ",(0,r.kt)("strong",{parentName:"p"},"\u4e0a\u4e00\u7bc7\u63d0\u5230 \u8981\u7279\u5225\u6ce8\u610f\u7684\u4e8b\u9805")," \u88e1\u63d0\u5230\u7684\u5169\u500b\u7279\u5225\u7684 useState \u7279\u6027\u55ce\uff1f \u6211\u5011\u4f86\u5617\u8a66\u628a\u9019\u5169\u500b\u7279\u6027\u52a0\u5165\u6211\u5011\u7684\u7a0b\u5f0f\u78bc\u5167\u3002"),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"\u5be6\u73fe-setcountcount--1-and-setcountcount--count--1-\u7684\u4e0d\u540c"},"\u5be6\u73fe setCount(count + 1) and setCount((count) => count + 1) \u7684\u4e0d\u540c"),(0,r.kt)("p",null,"\u539f\u672c setCount(count + 1) \u9019\u88e1\u7684 count \u662f\u6307\u9801\u9762\u672c\u8eab\u7684 count\u3002\n\u800c setCount(count => count + 1) \u7684 count \u662f callback \u56de\u50b3\u56de\u4f86\u7684 state\u3002"),(0,r.kt)("p",null,"\u5c07\u539f\u672c useState \u88e1\u7684 callback \u6539\u6210\u5982\u4e0b"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-jsx",metastring:"showLineNumbers",showLineNumbers:!0},"const callback = (newState) => {\n  if (typeof newState === 'function') {\n    memoizedState[currentCursor] = newState(memoizedState[currentCursor]);\n  } else {\n    memoizedState[currentCursor] = newState;\n  }\n  cursor = 0;\n  render(<SampleUseState />, document.getElementById('root'));\n};\n")),(0,r.kt)("p",null,"\u9019\u6a23\u6211\u5011\u81ea\u5b9a\u7fa9\u7684 useState \u4e5f\u80fd\u5728\u4f7f\u7528 setCount \u7684\u6642\u5019\uff0c\u50b3\u5165\u4e00\u500b callback function \u4e14\u6548\u679c\u5c31\u8ddf React Hook \u4e00\u6a23\uff0c\u80fd\u62ff\u5230\u6700\u5373\u6642\u7684 state \u53bb\u8655\u7406\u3002"),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"\u5be6\u73fe-lazy-initial-state"},"\u5be6\u73fe Lazy initial state"),(0,r.kt)("p",null,"\u5be6\u73fe\u8ddf\u4e0a\u9762\u7684\u505a\u6cd5\u5f88\u96f7\u540c\uff0c\u5c31\u662f\u7576\u50b3\u5165\u7684 initalValue \u4e5f\u662f\u4e00\u500b function \u6642\uff0c\u9700\u8981\u53e6\u5916\u505a\u8655\u7406\u3002\u9019\u908a\u76f4\u63a5\u9644\u4e0a\u6700\u5f8c\u5b8c\u6574\u7684\u7a0b\u5f0f\u78bc"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-jsx",metastring:"showLineNumbers",showLineNumbers:!0},"import React from 'react';\nimport { render } from 'react-dom';\nlet memoizedState = [];\nlet cursor = 0;\n\nconst useState = (initialValue) => {\n  if (typeof initialValue === 'function') {\n    memoizedState[cursor] = memoizedState[cursor] || initialValue();\n  } else {\n    memoizedState[cursor] = memoizedState[cursor] || initialValue;\n  }\n  const currentCursor = cursor;\n  const callback = (newState) => {\n    if (typeof newState === 'function') {\n      memoizedState[currentCursor] = newState(memoizedState[currentCursor]);\n    } else {\n      memoizedState[currentCursor] = newState;\n    }\n    cursor = 0;\n    render(<SampleUseState />, document.getElementById('root'));\n  };\n  return [memoizedState[cursor++], callback];\n};\n\nconst expensive = () => {\n  console.log('expensive');\n  return 0;\n};\n\nconst SampleUseState = () => {\n  const [count, setCount] = useState(() => expensive());\n  const clickHandler = () => {\n    setCount((count) => count + 1);\n    setCount((count) => count + 1);\n  };\n  return (\n    <div>\n      <p>You clicked {count} times</p>\n      <button onClick={() => clickHandler()}>Click me</button>\n    </div>\n  );\n};\n\nexport default SampleUseState;\n")),(0,r.kt)("p",null,"\u9019\u6a23\u5c31\u80fd\u767c\u63ee\u5230 Lazy initial state \u7684\u7279\u6027\uff0c\u5728\u7b2c\u4e00\u6b21\u8f09\u5165\u6642\uff0c\u624d\u6703\u57f7\u884c\u5230 expensive \u7684 function\uff0c\u4e4b\u5f8c rerender \u90fd\u4e0d\u6703\u4f7f\u7528\u5230\u3002"))}m.isMDXComponent=!0}}]);